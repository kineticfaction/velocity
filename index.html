<!doctype html>
<html>
  <head>
  		<meta charset="utf-8">
		<title>Game</title>
		<style>
			body {
				background-color: #333;
			}
			#container {
				background-color: black;
				width: 800px;
				height: 450px;
				margin: auto;
				align: center;
			}
		</style>
		<script src='./js/Three.js'></script>
	</head>
	<body>
		<div id="container"></div>
		<script>
			// shim layer with setTimeout fallback
			window.requestAnimFrame = (function(){
			  return  window.requestAnimationFrame       ||
			          window.webkitRequestAnimationFrame ||
			          window.mozRequestAnimationFrame    ||
			          function( callback ){
			            window.setTimeout(callback, 1000 / 60);
			          };
			})();

			var constants = {
				scene: {
					width: 800,
					height: 450
				},
				camera: {
					fov: 45,
					near: 0.1,
					far: 1000
				}
			}

			var container = document.getElementById("container");

			// create a WebGL renderer, camera
			// and a scene
			var renderer = new THREE.WebGLRenderer();
			var camera = new THREE.PerspectiveCamera(
				constants.camera.fov,
			    constants.scene.width / constants.scene.height,
			    constants.camera.near,
			    constants.camera.far
			);
			var scene = new THREE.Scene();

			// the camera starts at 0,0,0 so pull it back
			camera.position.z = 400;
			camera.position.y = 0;
			camera.rotation.x = 0;

			// start the renderer
			renderer.setSize(
				constants.scene.width, 
				constants.scene.height
			);

			// attach the render-supplied DOM element
			container.appendChild(renderer.domElement);

			// create the sphere's material
			var sphereMaterial = new THREE.MeshLambertMaterial({
			    color: 0xCCCCCC
			});

			// create a new mesh with sphere geometry -
			// we will cover the sphereMaterial next!

			var cube = new THREE.Mesh(
				new THREE.CubeGeometry(50,20,20), 
				sphereMaterial
			);

			scene.add(cube);
			scene.add(camera);

			cube.position.y = -30;

			// create a point light
			var lights = []

			lights[0] = new THREE.PointLight( 0xFF3333 );
			lights[1] = new THREE.PointLight( 0x33FF33 );
			lights[2] = new THREE.PointLight( 0x3333FF );


			// set its position
			lights[0].position.x = 10;
			lights[0].position.y = 50;
			lights[0].position.z = 130;

			// set its position
			lights[1].position.x = -100;
			lights[1].position.y = -50;
			lights[1].position.z = 130;

			// set its position
			lights[2].position.x = 100;
			lights[2].position.y = 50;
			lights[2].position.z = -130;

			// add to the scene
			scene.add(lights[0]);
			scene.add(lights[1]);
			scene.add(lights[2]);


			//var keyboard = new THREEx.KeyboardState();

			var havePointerLock = 'pointerLockElement' in document ||
    			'mozPointerLockElement' in document ||
    			'webkitPointerLockElement' in document;

    		if(havePointerLock) {

				container.addEventListener('click', function() {

					container.requestPointerLock = container.requestPointerLock ||
						container.mozRequestPointerLock ||
						container.webkitRequestPointerLock;

					// Ask the browser to lock the pointer
					container.requestPointerLock();

					container.addEventListener('mousemove', function(e) {
						 	movementX = 	e.movementX       ||
                    						e.mozMovementX    ||
                      						e.webkitMovementX ||
                      						0,
          					movementY = 	e.movementY       ||
                      						e.mozMovementY    ||
                      						e.webkitMovementY ||
                      						0;
					}, false);

					// Ask the browser to release the pointer
					document.exitPointerLock = document.exitPointerLock ||
								document.mozExitPointerLock ||
								document.webkitExitPointerLock;
					document.exitPointerLock();


				}, false);

    			
    		}

			var movementX = 0;
			var movementY = 0;
			

			// draw!
			(function animloop(){
			  requestAnimFrame(animloop);
			  update();
			  render();
			})();

			function update() {

				if(movementX > 10) { movementX = 10; }
				if(movementX < -10) { movementX = -10; }
				cube.rotation.y += movementX / 50;
				movementX = 0;

				if(movementY > 10) { movementY = 10; }
				if(movementY < -10) { movementY = -10; }
				cube.rotation.x += movementY / 250;
				movementY = 0;

			}	

			function render() {
				renderer.render(scene, camera);
			}


		</script>
	</body>
</html>