<!doctype html>
<html>
  <head>
  		<meta charset="utf-8">
		<title>Game</title>
		<style>
			body {
				background-color: #333;
			}
			#container {
				background-color: black;
				width: 800px;
				height: 450px;
				margin: auto;
				text-align: center;
			}
		</style>
		<script src='./js/three.min.js'></script>
		<script>

			var velocity = {};

		</script>
		<script src='./js/velocity.class.js'></script>
		<script src='./js/velocity.class.observable.js'></script>
		<script src='./js/velocity.class.actor.js'></script>
		<script src='./js/velocity.js'></script>
	</head>
	<body>
		<div id="container"></div>
		<script>

			var container = document.getElementById("container");

			velocity.camera.position.z = 400;
			velocity.camera.position.y = 0;
			velocity.camera.rotation.x = 0;

			// start the renderer
			velocity.renderer.setSize(
				800, 
				450
			);

			// attach the render-supplied DOM element
			container.appendChild(velocity.renderer.domElement);

			var cubeMaterial = new THREE.MeshLambertMaterial({
				color: 0xCCCCCC
			});

			var cube1 = new THREE.Mesh(
				new THREE.CubeGeometry(50,20,20), 
				cubeMaterial
			);

			var cube2 = new THREE.Mesh(
				new THREE.CubeGeometry(50,20,20), 
				cubeMaterial
			);

			var cube3 = new THREE.Mesh(
				new THREE.CubeGeometry(50,20,20), 
				cubeMaterial
			);

			velocity.scene.add(velocity.camera);
			velocity.scene.add(cube1);
			velocity.scene.add(cube2);
			velocity.scene.add(cube3);

			cube1.position.y = -20;
			cube2.position.y = -60;
			cube3.position.y = -100;

			// create a point light
			var lights = []

			lights[0] = new THREE.PointLight( 0xFF3333 );
			lights[1] = new THREE.PointLight( 0x33FF33 );
			lights[2] = new THREE.PointLight( 0x3333FF );


			// set its position
			lights[0].position.x = 10;
			lights[0].position.y = 50;
			lights[0].position.z = 130;

			// set its position
			lights[1].position.x = -100;
			lights[1].position.y = -50;
			lights[1].position.z = 130;

			// set its position
			lights[2].position.x = 100;
			lights[2].position.y = 50;
			lights[2].position.z = -130;

			// add to the scene
			velocity.scene.add(lights[0]);
			velocity.scene.add(lights[1]);
			velocity.scene.add(lights[2]);

			var havePointerLock = 	'pointerLockElement' in document ||
									'mozPointerLockElement' in document ||
									'webkitPointerLockElement' in document;

			if(havePointerLock) {
				container.addEventListener('click', function() {
					container.requestPointerLock = 	container.requestPointerLock ||
													container.mozRequestPointerLock ||
													container.webkitRequestPointerLock;
					// Ask the browser to lock the pointer
					container.requestPointerLock();
					container.addEventListener('mousemove', function(e) {
						movementX = 	e.movementX       ||
										e.mozMovementX    ||
				  						e.webkitMovementX ||
				  						0,
						movementY = 	e.movementY       ||
				  						e.mozMovementY    ||
				  						e.webkitMovementY ||
				  						0;
					}, false);
					// Ask the browser to release the pointer
					document.exitPointerLock = 	document.exitPointerLock ||
												document.mozExitPointerLock ||
												document.webkitExitPointerLock;
					document.exitPointerLock();
				}, false);

			}

			var movementX = 0;
			var movementY = 0;



			var updateLights = function() {
				lights[0].position.x = lights[0].position.x + 1;
				lights[1].position.y = lights[1].position.y + 1;
				lights[2].position.z = lights[2].position.z + 1;
			}



			var updatePlayer = function() {
				if(movementX > 10) { movementX = 10; }
				if(movementX < -10) { movementX = -10; }
				velocity.camera.rotation.y += movementX / 500;
				movementX = 0;

				if(movementY > 10) { movementY = 10; }
				if(movementY < -10) { movementY = -10; }
				velocity.camera.rotation.x += movementY / 2500;
				movementY = 0;
			}

			velocity.update.subscribe(updatePlayer);
			velocity.update.subscribe(updateLights);

			velocity.eventloop();


		</script>
	</body>
</html>